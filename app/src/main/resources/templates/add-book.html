<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout}">
<head>
    <title>Add New Book</title>
</head>
<body>
    <div th:fragment="content">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h2 class="mb-0">ðŸ“š Add New Book</h2>
                    </div>
                    <div class="card-body">
                        <form id="addBookForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="title" class="form-label">Title *</label>
                                        <input type="text" class="form-control" id="title" name="title" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="author" class="form-label">Author *</label>
                                        <input type="text" class="form-control" id="author" name="author" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="isbn" class="form-label">ISBN *</label>
                                        <input type="text" class="form-control" id="isbn" name="isbn" required>
                                        <div class="form-text">Enter the 13-digit ISBN</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="price" class="form-label">Price ($) *</label>
                                        <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="stockQuantity" class="form-label">Initial Stock Quantity *</label>
                                        <input type="number" class="form-control" id="stockQuantity" name="stockQuantity" min="0" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a th:href="@{/books}" class="btn btn-secondary me-md-2">Cancel</a>
                                <button type="submit" class="btn btn-success">Add Book</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.getElementById('addBookForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const bookData = {
                    title: formData.get('title'),
                    author: formData.get('author'),
                    isbn: formData.get('isbn'),
                    price: parseFloat(formData.get('price')),
                    stockQuantity: parseInt(formData.get('stockQuantity'))
                };
                
                fetch('/api/books', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookData)
                })
                .then(response => {
                    if (response.ok) {
                        alert('Book added successfully!');
                        window.location.href = '/books';
                    } else {
                        return response.text().then(text => {
                            throw new Error(text || 'Error adding book');
                        });
                    }
                })
                .catch(error => {
                    alert('Error: ' + error.message);
                });
            });
        </script>
    </div>
</body>
</html>